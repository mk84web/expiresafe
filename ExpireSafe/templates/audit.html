{% extends "base.html" %}
{% block title %}Audit Log | ExpireSafe{% endblock %}
{% block content %}
<h1 class="text-2xl font-bold mb-4">Audit Log</h1>
<p class="text-sm text-slate-500 dark:text-slate-400 mb-4">{{ total }} events total â€” page {{ page }} of {{ total_pages }}.</p>

<div class="bg-white dark:bg-slate-800 rounded shadow overflow-x-auto">
  <table class="w-full text-sm">
    <thead class="bg-slate-100 dark:bg-slate-700 text-left">
      <tr>
        <th class="px-4 py-2">Time (UTC)</th>
        <th class="px-4 py-2">User</th>
        <th class="px-4 py-2">Action</th>
        <th class="px-4 py-2">Entity</th>
        <th class="px-4 py-2">IP</th>
      </tr>
    </thead>
    <tbody>
      {% for r in rows %}
      <tr class="border-t dark:border-slate-700">
        <td class="px-4 py-2 text-xs text-slate-600 dark:text-slate-300">{{ r.created_at|fmt_time }}</td>
        <td class="px-4 py-2">{{ r.username }}</td>
        <td class="px-4 py-2">{{ r.action }}</td>
        <td class="px-4 py-2 text-slate-500 dark:text-slate-400">{{ r.entity_type }} {% if r.entity_id %}#{{ r.entity_id }}{% endif %}</td>
        <td class="px-4 py-2 text-xs text-slate-500 dark:text-slate-400">{{ r.ip_address }}</td>
      </tr>
      {% else %}
      <tr><td colspan="5" class="px-4 py-4 text-center text-slate-400 dark:text-slate-400">No audit events.</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- Pagination -->
<div class="flex justify-center gap-2 mt-4 text-sm">
  {% if page > 1 %}
  <a href="{{ url_for('audit_page', page=page-1, per_page=per_page) }}" class="px-3 py-1 bg-indigo-100 text-indigo-700 dark:bg-indigo-900 dark:text-indigo-300 rounded hover:bg-indigo-200 dark:hover:bg-indigo-800">&larr; Prev</a>
  {% endif %}
  <span class="px-3 py-1 text-slate-600 dark:text-slate-400">Page {{ page }} / {{ total_pages }}</span>
  {% if page < total_pages %}
  <a href="{{ url_for('audit_page', page=page+1, per_page=per_page) }}" class="px-3 py-1 bg-indigo-100 text-indigo-700 dark:bg-indigo-900 dark:text-indigo-300 rounded hover:bg-indigo-200 dark:hover:bg-indigo-800">Next &rarr;</a>
  {% endif %}
</div>
{% endblock %}
