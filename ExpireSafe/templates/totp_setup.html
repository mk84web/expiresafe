{% extends "base.html" %}
{% block title %}Two-Factor Authentication | ExpireSafe{% endblock %}
{% block content %}
<div class="max-w-2xl mx-auto">
  <h1 class="text-3xl font-bold mb-6 text-center">Two-Factor Authentication (2FA)</h1>

  {% if is_enabled %}
  <div class="bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200 p-5 rounded-lg mb-6 text-base text-center">
    âœ… Two-factor authentication is <strong>enabled</strong>.
  </div>
  <form method="post" class="bg-white dark:bg-slate-800 p-8 rounded-lg shadow">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
    <input type="hidden" name="action" value="disable" />
    <p class="text-base mb-5">Disabling 2FA will remove the extra security layer from your account.</p>
    <button class="px-6 py-3 text-base bg-red-600 text-white rounded-lg hover:bg-red-700 font-medium" onclick="return confirm('Disable 2FA?')">Disable 2FA</button>
  </form>

  {% else %}
  <div class="bg-white dark:bg-slate-800 p-8 rounded-lg shadow space-y-6">
    <p class="text-base">Enable TOTP-based two-factor authentication. Use any authenticator app (Google Authenticator, Authy, 1Password, etc.).</p>
    <div class="bg-slate-50 dark:bg-slate-700 p-5 rounded-lg">
      <p class="text-sm text-slate-500 dark:text-slate-400 mb-2">Your secret key (enter in authenticator app):</p>
      <code class="block text-xl tracking-widest font-mono break-all select-all">{{ secret }}</code>
      <p class="text-sm text-slate-500 dark:text-slate-400 mt-3">Account: {{ email }}</p>
    </div>
    <form method="post" class="space-y-5">
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
      <input type="hidden" name="action" value="enable" />
      <input type="hidden" name="secret" value="{{ secret }}" />
      <div>
        <label class="block text-sm text-slate-500 dark:text-slate-400 mb-2">Enter the 6-digit code from your app</label>
        <input type="text" name="code" pattern="\d{6}" maxlength="6" required placeholder="000000"
               class="w-full px-4 py-3 border rounded-lg text-center text-2xl tracking-widest dark:bg-slate-700 dark:border-slate-600 dark:text-slate-200 dark:placeholder-slate-400" />
      </div>
      <button class="w-full py-3 text-base bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 font-medium">Verify & Enable 2FA</button>
    </form>
  </div>
  {% endif %}
</div>
{% endblock %}
