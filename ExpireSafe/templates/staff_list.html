{% extends "base.html" %}
{% block title %}Staff | ExpireSafe{% endblock %}
{% block content %}
<h1 class="text-2xl font-bold mb-4">Staff Members</h1>

<!-- Search / filter -->
<form method="get" class="mb-4 flex gap-2 items-center">
  <input type="text" name="q" value="{{ q }}" placeholder="Search by name, role or email…" class="px-3 py-2 border rounded flex-1 dark:bg-slate-800 dark:border-slate-600 dark:text-slate-200 dark:placeholder-slate-400" />
  <button class="px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 text-sm">Search</button>
  {% if q %}<a href="{{ url_for('staff_list') }}" class="text-sm text-slate-500 dark:text-slate-400 hover:underline">Clear</a>{% endif %}
  <a href="{{ url_for('staff_list', show_archived='1') }}" class="text-xs text-slate-500 dark:text-slate-400 hover:underline ml-2">Show archived</a>
</form>

<form method="post" class="bg-white dark:bg-slate-800 p-4 rounded shadow flex flex-wrap gap-2 mb-6 items-end">
  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
  <div class="flex-1 min-w-[150px]">
    <label class="block text-xs text-slate-500 dark:text-slate-400">Full Name*</label>
    <input type="text" name="full_name" required class="w-full px-3 py-2 border rounded dark:bg-slate-700 dark:border-slate-600 dark:text-slate-200" />
  </div>
  <div class="flex-1 min-w-[120px]">
    <label class="block text-xs text-slate-500 dark:text-slate-400">Job Title</label>
    <input type="text" name="role" class="w-full px-3 py-2 border rounded dark:bg-slate-700 dark:border-slate-600 dark:text-slate-200" />
  </div>
  <div class="flex-1 min-w-[150px]">
    <label class="block text-xs text-slate-500 dark:text-slate-400">Email</label>
    <input type="email" name="email" class="w-full px-3 py-2 border rounded dark:bg-slate-700 dark:border-slate-600 dark:text-slate-200" />
  </div>
  <button class="px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700">+ Add Staff</button>
</form>

<div class="bg-white dark:bg-slate-800 rounded shadow overflow-x-auto">
  <table class="w-full text-sm">
    <thead class="bg-slate-100 dark:bg-slate-700 text-left">
      <tr>
        <th class="px-4 py-2">Name</th>
        <th class="px-4 py-2">Job Title</th>
        <th class="px-4 py-2">Email</th>
        <th class="px-4 py-2"></th>
      </tr>
    </thead>
    <tbody>
      {% for s in staff %}
      <tr class="border-t dark:border-slate-700 {{ 'opacity-50' if s.archived_at }}">
        <td class="px-4 py-2">{{ s.full_name }}{% if s.archived_at %} <span class="text-xs text-slate-400 dark:text-slate-400">(archived)</span>{% endif %}</td>
        <td class="px-4 py-2">{{ s.role or '—' }}</td>
        <td class="px-4 py-2">{{ s.email or '—' }}</td>
        <td class="px-4 py-2 text-right space-x-2">
          <a href="{{ url_for('staff_profile', staff_id=s.id) }}" class="text-indigo-600 dark:text-indigo-400 hover:underline text-xs">View / Docs →</a>
          <a href="{{ url_for('edit_staff', staff_id=s.id) }}" class="text-indigo-600 dark:text-indigo-400 hover:underline text-xs">Edit</a>
          {% if session.role == 'OWNER' and not s.archived_at %}
          <form method="post" action="{{ url_for('archive_staff', staff_id=s.id) }}" class="inline" onsubmit="return confirm('Archive {{ s.full_name }}?')">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
            <button class="text-slate-600 dark:text-slate-200 hover:underline text-xs">Archive</button>
          </form>
          {% elif session.role == 'OWNER' and s.archived_at %}
          <form method="post" action="{{ url_for('restore_staff', staff_id=s.id) }}" class="inline">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
            <button class="text-green-600 dark:text-green-400 hover:underline text-xs">Restore</button>
          </form>
          {% endif %}
          {% if session.role == 'OWNER' %}
          <form method="post" action="{{ url_for('delete_staff', staff_id=s.id) }}" class="inline" onsubmit="return confirm('Permanently delete {{ s.full_name }} and all their documents?')">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
            <button class="text-slate-800 dark:text-slate-200 hover:underline text-xs">Delete</button>
          </form>
          {% endif %}
        </td>
      </tr>
      {% else %}
      <tr><td colspan="4" class="px-4 py-4 text-center text-slate-400 dark:text-slate-400">No staff found.</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
